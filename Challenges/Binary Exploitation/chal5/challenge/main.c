#include <stdio.h>
#include <stdlib.h>
#include <unistd.h>
#include <string.h>



struct User
{
    char username[0x20];
    long is_admin;
    char * secret;
};
typedef struct User User;


void setup(){
    setbuf(stdin,0);
    setbuf(stdout,0);
}

void menu(){
    puts("Options : ");
    puts("1- create user");
    puts("2- modifie secret");
    puts("3- delete secret");
    puts("4- print secret");

}
User * users[0x10]={NULL};
size_t users_number=0;
int main(){

    setup();
    puts("welcome to Secret Manager");
    puts("+++++++++++++++++++++++++");
    while(1){
        menu();
        int choice=0,index=0;

        scanf("%d%*c",&choice);
        switch (choice)
        {
        case 1:
            if (users_number<0x10){
                User * user=(User*)malloc(sizeof(User));
                user->is_admin=0;
                user->secret=NULL;
                printf("Username : ");
                fgets(user->username,sizeof(user->username),stdin);
                printf("user created at index %d\n",users_number);
                users[users_number++]=user;
            }
            else{
                puts("no storage left");
            }
            
            break;
        case 2:
            printf("Index : ");
            scanf("%d%*c",&index);
            if (0<=index<0x10 & users[index]!=NULL){
                User * user=users[index];
                if (user->secret==NULL){
                    user->secret=malloc(0x30);
                }
                printf("secret : ");
                fgets(user->secret,0x30,stdin);
            }
            else{
                puts("invalid index");
            }
            break;
        case 3:
            printf("Index : ");
            scanf("%d%*c",&index);
            if (0<=index<0x10 & users[index]!=NULL){
                User * user=users[index];
                if (user->secret==NULL){
                    puts("no secret yet");
                }
                else
                    free(user->secret);
            }
            else{
                puts("invalid index");
            }
            break;
        case 4 :
            printf("Index : ");
            scanf("%d%*c",&index);
            if (0<=index<0x10 & users[index]!=NULL){
                User * user=users[index];
                if (user->is_admin==0x1337){
                    system("/bin/sh");
                }
                else{
                    printf("secret : %s\n",user->secret);
                }
            }
            else{
                puts("invalid index");
            }
            break;
        case 5 : 
            exit(0);
        default:
            puts("invalid choice");
            break;
        }
    }
    return 1;

}
